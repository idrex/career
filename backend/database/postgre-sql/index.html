<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="/logo.svg" />
    <link rel="stylesheet" href="/umi.css" />
    <script>
      window.routerBase = "/";
    </script>
    <script>
      //! umi version: 3.2.14
    </script>
    <title>PostgreSQL</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;/logo.svg&#x27;)" href="/">Drex</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><a href="/guide">指南</a><a href="/fontend">前端</a><a aria-current="page" class="active" href="/backend">后端</a><a href="/devops">运维</a><a href="/blog">博客</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/idrex/career">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;/logo.svg&#x27;)" href="/"></a><h1>Drex</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/guide">指南</a></li><li><a href="/fontend">前端</a></li><li><a aria-current="page" class="active" href="/backend">后端</a></li><li><a href="/devops">运维</a></li><li><a href="/blog">博客</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/idrex/career">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a href="/backend">后端体系图</a></li><li><a href="/backend/network">网络基础</a><ul><li><a href="/backend/network/api"><span>接口选型</span></a></li><li><a href="/backend/network/network"><span>网络协议</span></a></li></ul></li><li><a href="/backend/system">Web服务器</a><ul><li><a href="/backend/system/nginx"><span>Nginx</span></a></li></ul></li><li><a aria-current="page" class="active" href="/backend/database">数据库</a><ul><li><a aria-current="page" class="active" href="/backend/database/postgre-sql"><span>PostgreSQL</span></a></li><li><a href="/backend/database/my-sql"><span>MySQL</span></a></li><li><a href="/backend/database/table-store"><span>TableStore</span></a></li><li><a href="/backend/database/sequelize"><span>Sequelize</span></a></li><li><a href="/backend/database/redis"><span>Redis</span></a></li></ul></li><li><a href="/backend/node">Node</a><ul><li><a href="/backend/node/basic"><span>Node基础</span></a></li><li><a href="/backend/node/evenloop"><span>Node 事件循环</span></a></li><li><a href="/backend/node/yarn&amp;npm&amp;cnpm"><span>yarn、npm、cnpm 对比分析</span></a></li></ul></li><li><a href="/backend/test">测试</a><ul><li><a href="/backend/test/utils"><span>测试工具</span></a></li></ul></li></ul></div></div><ul class="__dumi-default-layout-toc" role="slug-list"><li title="安装使用" data-depth="2" class=""><a href="/backend/database/postgre-sql#安装使用"><span>安装使用</span></a></li><li title="Mac" data-depth="3" class=""><a href="/backend/database/postgre-sql#mac"><span>Mac</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h2 id="安装使用"><a aria-hidden="true" href="#安装使用"><span class="icon icon-link"></span></a>安装使用</h2><h3 id="mac"><a aria-hidden="true" href="#mac"><span class="icon icon-link"></span></a>Mac</h3><p>homebrew安装</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="$ brew install postgresql
" data-status="copy"></button><div class="token-line"><span class="token plain">$ brew </span><span class="token function">install</span><span class="token plain"> postgresql</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>初始化：</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="$ initdb /usr/local/var/postgres
" data-status="copy"></button><div class="token-line"><span class="token plain">$ initdb /usr/local/var/postgres</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>创建数据库和账户 mac安装PostgreSQL后不会创建用户名数据库，执行命令：</p><p>createdb 然后登录PostgreSQL控制台：</p><p>psql psql连接数据库默认选用的是当前的系统用户</p><p>使用\l命令列出所有的数据库，看到已存在用户同名数据库、postgres数据库，但是postgres数据库的所有者是当前用户，没有postgres用户。</p><p>然后我们来完成以下几件事：</p><p>一、创建postgres用户</p><p>CREATE USER postgres WITH PASSWORD &#x27;post5432&#x27;; 二、删除默认生成的postgres数据库</p><p>DROP DATABASE postgres; 三、创建属于postgres用户的postgres数据库</p><p>CREATE DATABASE postgres OWNER postgres; 四、将数据库所有权限赋予postgres用户</p><p>GRANT ALL PRIVILEGES ON DATABASE postgres to postgres; 五、给postgres用户添加创建数据库的属性</p><p>ALTER ROLE postgres CREATEDB; 这样就可以使用postgres作为数据库的登录用户了，并可以使用该用户管理数据库</p><p>登陆控制台指令 psql -U [user] -d [database] -h [host] -p [port] -U指定用户，-d指定数据库，-h指定服务器，-p指定端口 完整的登录命令，比如使用postgres用户登录</p><p>psql -U postgres -d postgres 之前我们直接使用psql登录控制台，实际上使用的是缺省数据</p><p>user：当前mac用户 database：用户同名数据库 主机：localhost 端口号：5432，postgresql的默认端口是5432 常用控制台指令 \password：设置当前登录用户的密码 \h：查看SQL命令的解释，比如\h select。 \?：查看psql命令列表。 \l：列出所有数据库。 \c [database_name]：连接其他数据库。 \d：列出当前数据库的所有表格。 \d [table_name]：列出某一张表格的结构。 \du：列出所有用户。 \e：打开文本编辑器。 \conninfo：列出当前数据库和连接的信息。 \password [user]: 修改用户密码 \q：退出 使用PostgreSQL 现在来简单的学习一下使用PostgreSQL，以下命令都在postgres=# 环境下 修改用户密码 之前我们用命令CREATE USER postgres WITH PASSWORD &#x27;XXXXXX&#x27;;创建了postgres用户，现在我们来修改该用户的密码：</p><p>ALTER USER postgres WITH PASSWORD &#x27;XXXXXX&#x27; 出现ALTER ROLE, 代表修改角色成功</p><p>创建和删除数据库用户 创建user1用户：CREATE USER user1 WITH PASSWORD &#x27;XXXX&#x27;</p><p>查看数据库用户列表：\du</p><p>删除数据库用户：drop user user1;</p><p>创建和删除数据库 创建数据库：create database testdb;</p><p>查看数据库列表：\l</p><p>删除数据库：drop database db1;</p><p>创建和删除数据表 选择数据库：\c DatabaseName，比如\c testdb</p><p>创建数据库表：CREATE TABLE COMPANY( ID INT PRIMARY KEY NOT NULL, NAME TEXT NOT NULL, AGE INT NOT NULL, ADDRESS CHAR(50), SALARY REAL);</p><p>删除数据库表： drop table company;</p><p>查看数据库信息：\d</p><p>查询数据：select * from company</p><p>关于第三方连接本地数据库的问题 如何设置PostgreSQL允许被远程访问</p><p>/usr/local/var/postgres/postgresql.conf 修改postgresql.conf 编辑或添加下面一行，使PostgreSQL可以接受来自任意IP的连接请求。 listen_addresses = &#x27;*&#x27; 修改pg_hba.conf pg_hba.conf，位置与postgresql.conf相同，虽然上面配置允许任意地址连接PostgreSQL，但是这在pg中还不够，我们还需在pg_hba.conf中配置服务端允许的认证方式。任意编辑器打开该文件，编辑或添加下面一行。</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="# TYPE  DATABASE  USER  CIDR-ADDRESS  METHOD
host  all  all 0.0.0.0/0 md5
" data-status="copy"></button><div class="token-line"><span class="token comment"># TYPE  DATABASE  USER  CIDR-ADDRESS  METHOD</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">host</span><span class="token plain">  all  all </span><span class="token number">0.0</span><span class="token plain">.0.0/0 md5</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>默认pg只允许本机通过密码认证登录，修改为上面内容后即可以对任意IP访问进行密码验证。对照上面的注释可以很容易搞明白每列的含义，具体的支持项可以查阅文末参考引用。</p><p>完成上两项配置后执行sudo service postgresql restart重启PostgreSQL服务后，允许外网访问的配置就算生效了。</p></div><div class="__dumi-default-layout-footer-meta"><span data-updated-text="Last Update: ">7/31/2020, 1:16:36 PM</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/umi.js"></script>
  </body>
</html>
