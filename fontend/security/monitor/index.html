<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="/logo.svg" />
    <link rel="stylesheet" href="/umi.css" />
    <script>
      window.routerBase = "/";
    </script>
    <script>
      //! umi version: 3.2.28
    </script>
    <title>监控体系</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;/logo.svg&#x27;)" href="/">Drex</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><a href="/guide">指南</a><a aria-current="page" class="active" href="/fontend">前端</a><a href="/backend">后端</a><a href="/devops">运维</a><a href="/blog">博客</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/idrex/career">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;/logo.svg&#x27;)" href="/"></a><h1>Drex</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/guide">指南</a></li><li><a aria-current="page" class="active" href="/fontend">前端</a></li><li><a href="/backend">后端</a></li><li><a href="/devops">运维</a></li><li><a href="/blog">博客</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/idrex/career">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a href="/fontend">前端体系图</a></li><li><a href="/fontend/browser">浏览器</a><ul><li><a href="/fontend/browser/basic"><span>基础知识</span></a></li><li><a href="/fontend/browser/model"><span>浏览器模型</span></a></li><li><a href="/fontend/browser/optimization"><span>性能优化</span></a></li><li><a href="/fontend/browser/request"><span>网络请求</span></a></li></ul></li><li><a href="/fontend/html">Html</a><ul><li><a href="/fontend/html/basic"><span>基础知识</span></a></li></ul></li><li><a href="/fontend/css">CSS</a><ul><li><a href="/fontend/css/basic"><span>基础知识</span></a></li><li><a href="/fontend/css/less"><span>Less</span></a></li></ul></li><li><a href="/fontend/javasrcipt">Javasrcipt</a><ul><li><a href="/fontend/javasrcipt/basic"><span>基础中的基础</span></a></li><li><a href="/fontend/javasrcipt/application"><span>基础应用</span></a></li><li><a href="/fontend/javasrcipt/esnext"><span>ES6 &amp; ES Next</span></a></li><li><a href="/fontend/javasrcipt/ts"><span>TypeScript</span></a></li><li><a href="/fontend/javasrcipt/issues"><span>JS 相关方法实现</span></a></li><li><a href="/fontend/javasrcipt/optimization"><span>代码优化技巧</span></a></li></ul></li><li><a href="/fontend/construct">构建工具</a><ul><li><a href="/fontend/construct/webpack"><span>Webpack</span></a></li></ul></li><li><a href="/fontend/frame">JS 框架</a><ul><li><a href="/fontend/frame/react"><span>React</span></a></li><li><a href="/fontend/frame/redux"><span>Redux</span></a></li><li><a href="/fontend/frame/vue"><span>Vue</span></a></li></ul></li><li><a href="/fontend/mobile">移动&amp;桌面应用</a><ul><li><a href="/fontend/mobile/certificate"><span>证书说明</span></a></li><li><a href="/fontend/mobile/hybrid"><span>Hybrid APP</span></a></li><li><a href="/fontend/mobile/react-native"><span>React Native</span></a></li></ul></li><li><a href="/fontend/setup">工程体系</a><ul><li><a href="/fontend/setup/pattern"><span>体系格局</span></a></li><li><a href="/fontend/setup/engineering"><span>前端工程化</span></a></li></ul></li><li><a href="/fontend/package">Package</a><ul><li><a href="/fontend/package/module"><span>模块化标准</span></a></li><li><a href="/fontend/package/npm"><span>Npm</span></a></li><li><a href="/fontend/package/yarn"><span>Yarn</span></a></li></ul></li><li><a aria-current="page" class="active" href="/fontend/security">Security</a><ul><li><a aria-current="page" class="active" href="/fontend/security/monitor"><span>监控体系</span></a></li><li><a href="/fontend/security/web"><span>Web 安全</span></a></li></ul></li><li><a href="/fontend/visual">Visual</a><ul><li><a href="/fontend/visual/map"><span>Map 地图组建</span></a></li></ul></li></ul></div></div><ul class="__dumi-default-layout-toc" role="slug-list"><li title="前端异常" data-depth="2" class=""><a href="/fontend/security/monitor#前端异常"><span>前端异常</span></a></li><li title="try...catch 可疑区监控" data-depth="3" class=""><a href="/fontend/security/monitor#trycatch-可疑区监控"><span>try...catch 可疑区监控</span></a></li><li title="window.onerror" data-depth="3" class=""><a href="/fontend/security/monitor#windowonerror"><span>window.onerror</span></a></li><li title="window.addEventListener" data-depth="3" class=""><a href="/fontend/security/monitor#windowaddeventlistener"><span>window.addEventListener</span></a></li><li title="Promise Catch" data-depth="3" class=""><a href="/fontend/security/monitor#promise-catch"><span>Promise Catch</span></a></li><li title="iframe 异常" data-depth="3" class=""><a href="/fontend/security/monitor#iframe-异常"><span>iframe 异常</span></a></li><li title="Script error" data-depth="3" class=""><a href="/fontend/security/monitor#script-error"><span>Script error</span></a></li><li title="网页崩溃" data-depth="3" class=""><a href="/fontend/security/monitor#网页崩溃"><span>网页崩溃</span></a></li><li title="监控方案" data-depth="2" class=""><a href="/fontend/security/monitor#监控方案"><span>监控方案</span></a></li><li title="数据上报" data-depth="3" class=""><a href="/fontend/security/monitor#数据上报"><span>数据上报</span></a></li><li title="异常定位" data-depth="3" class=""><a href="/fontend/security/monitor#异常定位"><span>异常定位</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="监控体系"><a aria-hidden="true" href="#监控体系"><span class="icon icon-link"></span></a>监控体系</h1><p>在线上项目中,需要统计产品中用户行为和使用情况，从而可以从用户和产品的角度去了解用户群体，从而升级和迭代产品，使其更加贴近用户。用户行为数据可以通过前端数据监控的方式获得，除此之外，前端还需要实现性能监控和异常监控。性能监控包括首屏加载时间、白屏时间、http请求时间和http响应时间。异常监控包括前端脚本执行报错等。 实现前端监控有三个步骤：前端埋点和上报、数据处理和数据分析。</p><ol><li>数据监控</li></ol><ul><li>PV/UV:PV(page view)，即页面浏览量或点击量。UV:指访问某个站点或点击某条新闻的不同IP地址的人数</li><li>用户在每一个页面的停留时间</li><li>用户通过什么入口来访问该网页</li><li>用户在相应的页面中触发的行为</li></ul><ol start="2"><li>性能监控</li></ol><ul><li>不同用户，不同机型和不同系统下的首屏加载时间</li><li>白屏时间</li><li>http等请求的响应时间</li><li>静态资源整体下载时间</li><li>页面渲染时间</li><li>页面交互动画完成时间</li></ul><ol start="3"><li>异常监控</li></ol><ul><li>Javascript的异常监控</li><li>样式丢失的异常监控</li></ul><h2 id="前端异常"><a aria-hidden="true" href="#前端异常"><span class="icon icon-link"></span></a>前端异常</h2><h3 id="trycatch-可疑区监控"><a aria-hidden="true" href="#trycatch-可疑区监控"><span class="icon icon-link"></span></a>try...catch 可疑区监控</h3><p><code>try...catch</code> 只能捕获到同步的运行时错误，对于语法和异步错误无能为力，捕获不到。</p><h3 id="windowonerror"><a aria-hidden="true" href="#windowonerror"><span class="icon icon-link"></span></a>window.onerror</h3><p>当<code>JS</code>运行时错误发生时，<code>window</code> 会触发一个 <code>ErrorEvent</code> 接口的 <code>error</code> 事件，并执行 <code>window.onerror()</code> 。</p><ul><li>函数只有在返回 <code>true</code> 的时候，异常才不会向上抛出（浏览器接收后报红），否则即使是知道异常的发生控制台还是会显示 <code>Uncaught Error: xxxxx</code></li><li>最好写在所有 <code>JS</code> 脚本的前面，否则有可能捕获不到错误</li><li>无法捕获语法错误</li></ul><h3 id="windowaddeventlistener"><a aria-hidden="true" href="#windowaddeventlistener"><span class="icon icon-link"></span></a>window.addEventListener</h3><p>当一项资源（如图片和脚本加载失败），加载资源的元素会触发一个<code>Event</code>接口的<code>error</code>事件，并执行该元素上的<code>onerror</code>处理函数。这些<code>error</code>事件不会向上冒泡到<code>window</code>， 不过（至少在 <code>Chrome</code> 中）能被单一的<code>window.addEventListener</code> 捕获。</p><p>对于全局的错误捕获，在现代浏览器中，倾向于只使用<code>window.addEventListener(&#x27;error&#x27;)</code>，<code>window.addEventListener(&#x27;unhandledrejection&#x27;)</code>就行了。如果需要考虑兼容性，需要加上<code>window.onerror</code>，三者同时使用，<code>window.addEventListener(&#x27;error&#x27;)</code>专门用来捕获资源加载错误。</p><h3 id="promise-catch"><a aria-hidden="true" href="#promise-catch"><span class="icon icon-link"></span></a>Promise Catch</h3><p>我们知道，在 <code>promise</code> 中使用 <code>catch</code> 可以非常方便的捕获到异步 <code>error</code> 。</p><p>为了防止有漏掉的 <code>promise</code> 异常，建议在全局增加一个对 <code>unhandledrejection</code> 的监听，用来全局监听 <code>Uncaught Promise Error</code>。</p><h3 id="iframe-异常"><a aria-hidden="true" href="#iframe-异常"><span class="icon icon-link"></span></a>iframe 异常</h3><p>对于 <code>iframe</code> 的异常捕获，我们还得借力 <code>window.onerror</code></p><h3 id="script-error"><a aria-hidden="true" href="#script-error"><span class="icon icon-link"></span></a>Script error</h3><p>一般情况，如果出现 <code>Script error</code> 这样的错误，基本上可以确定是跨域问题。这时候，是不会有其他太多辅助信息的，但是解决思路无非如下：跨源资源共享机制( <code>CORS</code> )：我们为 <code>script</code> 标签添加 <code>crossOrigin</code> 属性。</p><h3 id="网页崩溃"><a aria-hidden="true" href="#网页崩溃"><span class="icon icon-link"></span></a>网页崩溃</h3><ol><li>利用 <code>window</code> 对象的 <code>load</code> 和 <code>beforeunload</code> 事件实现了网页崩溃的监控。</li><li>利用 <code>Service Worker</code> 有自己独立的工作线程，生命周期一般要比网页还要长，与网页区分开，网页崩溃了，<code>Service Worker</code> 一般情况下不会崩溃,可以通过 <code>navigator.serviceWorker.controller.postMessage API</code> 向掌管自己的 <code>SW</code> 发送消息</li></ol><h2 id="监控方案"><a aria-hidden="true" href="#监控方案"><span class="icon icon-link"></span></a>监控方案</h2><h3 id="数据上报"><a aria-hidden="true" href="#数据上报"><span class="icon icon-link"></span></a>数据上报</h3><ol><li>通过 Ajax 发送数据</li></ol><h3 id="异常定位"><a aria-hidden="true" href="#异常定位"><span class="icon icon-link"></span></a>异常定位</h3><p>参考：</p><p><a href="https://www.cnblogs.com/chenwenhao/p/12184733.html" target="_blank" rel="noopener noreferrer">谈谈前端异常捕获<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p><a href="https://cdc.tencent.com/2018/09/13/frontend-exception-monitor-research/" target="_blank" rel="noopener noreferrer">前端异常监控解决方案研究<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p><a href="https://segmentfault.com/a/1190000015864670" target="_blank" rel="noopener noreferrer">前端监控和前端埋点方案设计<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p><a href="https://segmentfault.com/a/1190000021663211" target="_blank" rel="noopener noreferrer">撸一个前端监控系统<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p><a href="http://www.webfunny.cn/home.html" target="_blank" rel="noopener noreferrer">Webfunny 开源监控<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p><a href="https://github.com/kisslove/web-monitoring" target="_blank" rel="noopener noreferrer">web-monitoring<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div><div class="__dumi-default-layout-footer-meta"><span data-updated-text="Last Update: ">11/27/2020, 9:47:03 AM</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/umi.js"></script>
  </body>
</html>
